import{b as U,o as f,c as ae,r as n,j as e,d as se,C as H,p as b}from"./index-D08kE7DX.js";import{C as Ne,T as je,a as le,S as ge,m as Q,n as pe,o as ve,L as ye,I as ke,p as Ce,b as we,D as Ee,h as De,i as Te,j as Pe,k as Ae,e as re,l as Se,g as ne,c as T,E as Ie,F as D,q as J,r as _e,s as K,t as Re,d as Le,f as Oe}from"./styles-CB0P9xDY.js";import{f as h,a as V}from"./formatters-D9zA15X6.js";import{P as Me,A as Z,D as Be,g as de,h as ie,i as Ve,e as Fe,j as ee,f as $e,X as Ge,E as qe,T as Ue}from"./index-Cn89rPqp.js";import{C as Xe}from"./ConfirmationModal-D8-a72df.js";import{D as te}from"./DetailRow-DwLpziCd.js";const Ze=l=>{const c=U(),k=f(a=>a.debts),o=f(a=>a.stats),C=f(a=>a.loadDebts),P=ae(a=>a.currencyCode),N=l.currencyCode??P;n.useEffect(()=>{C()},[C]);const t=()=>{l.onChangeView?l.onChangeView("create"):c(b.libretaNew())},d=a=>{l.onChangeView?l.onChangeView("detail",a):c(b.libretaDetail(a))},i=a=>{switch(a){case"paid":return"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300";case"overdue":return"bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300";case"pending":return"bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300";default:return"bg-slate-100 dark:bg-slate-900/50 text-slate-700 dark:text-slate-300"}},m=a=>{switch(a){case"paid":return"Pagado";case"overdue":return"Vencido";case"pending":return"Pendiente";default:return a}};return e.jsx("div",{className:"w-full space-y-6",children:e.jsxs("div",{className:Ne,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:je,children:"Libreta de Deudas"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Cuentas por cobrar y pagar"})]}),e.jsxs("button",{onClick:t,className:le,children:[e.jsx(Me,{className:"w-5 h-5"}),"Nueva Deuda"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:`${ge} flex flex-col justify-between`,children:[e.jsx("p",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-400 mb-1",children:"Por Cobrar"}),e.jsx("p",{className:"text-2xl font-bold tracking-tight text-emerald-700 dark:text-emerald-300",children:h(o.totalReceivablesPending,N)}),o.overdueReceivables>0&&e.jsxs("p",{className:`text-xs font-medium ${Q} mt-2 flex items-center gap-1`,children:[e.jsx(Z,{className:"w-3 h-3"}),o.overdueReceivables," vencido",o.overdueReceivables>1?"s":""]})]}),e.jsxs("div",{className:`${pe} flex flex-col justify-between`,children:[e.jsx("p",{className:"text-sm font-medium text-red-700 dark:text-red-300 mb-1",children:"Por Pagar"}),e.jsx("p",{className:"text-2xl font-bold tracking-tight text-red-700 dark:text-red-300",children:h(o.totalPayablesPending,N)}),o.overduePayables>0&&e.jsxs("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mt-2 flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),o.overduePayables," vencido",o.overduePayables>1?"s":""]})]})]}),e.jsx("div",{className:ve}),k.length===0?e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400 dark:text-slate-500 mb-4",children:e.jsx(Be,{className:"w-16 h-16 mx-auto"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-600 dark:text-slate-400 mb-2",children:"No hay deudas registradas"}),e.jsx("button",{onClick:t,className:"mt-4 text-emerald-600 dark:text-emerald-400 hover:underline font-semibold",children:"Registrar tu primera deuda"})]}):e.jsx("ul",{className:"divide-y divide-slate-200 dark:divide-slate-700 -mx-2",children:k.map(a=>e.jsx("li",{onClick:()=>d(a.id),className:ye,children:e.jsxs("div",{className:"flex items-center justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-3 min-w-0",children:[e.jsx("div",{className:`p-3 rounded-xl shrink-0 ${a.type==="receivable"?ke:Ce}`,children:a.type==="receivable"?e.jsx(de,{className:"w-6 h-6"}):e.jsx(ie,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100 truncate",children:a.counterparty}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 truncate mb-1",children:a.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[e.jsx("span",{className:`px-2.5 py-0.5 text-xs font-semibold rounded-md ${i(a.status)}`,children:m(a.status)}),a.category&&e.jsx("span",{className:"hidden sm:inline-block px-2.5 py-0.5 text-xs font-medium bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-md border border-slate-200 dark:border-slate-600",children:a.category}),e.jsxs("div",{className:"flex items-center text-xs text-slate-400 dark:text-slate-500 font-medium",children:[e.jsx(Ve,{className:"h-3.5 w-3.5 mr-1.5 -mt-0.5"}),e.jsx("span",{className:"whitespace-nowrap",children:new Date(a.dueDate).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})})]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end shrink-0 ml-2",children:[e.jsx("p",{className:`text-xl sm:text-2xl font-bold whitespace-nowrap ${a.type==="receivable"?we:Q}`,children:h(a.amount,N)}),e.jsx("span",{className:"text-xs text-slate-400 font-medium",children:a.type==="receivable"?"Por cobrar":"Por pagar"})]})]})},a.id))})]})})},et=l=>{const c=U(),k=f(s=>s.getById),o=f(s=>s.createDebt),C=f(s=>s.updateDebt),P=f(s=>s.deleteDebt),N=se(s=>s.showSuccessModal),t=l.mode??(l.debtId?"edit":"create"),d=l.debtId?k(l.debtId):null,[i,m]=n.useState("receivable"),[a,w]=n.useState(""),[E,p]=n.useState(""),[x,A]=n.useState(""),[j,_]=n.useState(""),[R,F]=n.useState(""),[S,L]=n.useState(""),[I,O]=n.useState(!1),[M,v]=n.useState(null),[r,u]=n.useState(!1),[$,ce]=n.useState([]),[oe,G]=n.useState(!1),[X,z]=n.useState(""),q=n.useRef(null);n.useEffect(()=>{var s;d&&(m(d.type),w(d.counterparty),p(((s=d.originalAmount)==null?void 0:s.toString())??d.amount.toString()),A(d.description),_(d.dueDate?d.dueDate.split("T")[0]:""),F(d.category??""),L(d.notes??""))},[d]),n.useEffect(()=>{ce(H.getAll())},[]),n.useEffect(()=>{const s=g=>{q.current&&!q.current.contains(g.target)&&G(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const me=()=>{l.onCancel?l.onCancel():c(b.libreta())},xe=()=>{u(!0)},ue=()=>{l.debtId&&P(l.debtId)&&(N("Deuda Eliminada","La deuda ha sido eliminada"),u(!1),l.onDelete?l.onDelete():c(b.libreta()))},W=n.useMemo(()=>{const s=i==="receivable"?"client":"supplier";return $.filter(g=>{const y=g.type===s,B=g.name.toLowerCase().includes(X.toLowerCase());return y&&B})},[$,i,X]),he=s=>{w(s),z(s),G(s.trim().length>=1)},be=s=>{w(s.name),z(""),G(!1)},fe=async s=>{if(s.preventDefault(),v(null),!a.trim()||!E||!x.trim()||!j){v("Por favor completa todos los campos obligatorios");return}const g=parseFloat(E);if(isNaN(g)||g<=0){v("Por favor ingresa un monto válido");return}O(!0);try{if(t==="create"){const B=i==="receivable"?"client":"supplier";$.find(Y=>Y.name.toLowerCase()===a.trim().toLowerCase()&&Y.type===B)||H.create({type:B,name:a.trim()})}let y;if(t==="create"?y=o(i,a,g,x,j,R||void 0,S||void 0):l.debtId&&(y=C(l.debtId,{type:i,counterparty:a,amount:g,description:x,dueDate:j,category:R||void 0,notes:S||void 0})),!y){v("Error al guardar la deuda");return}N(t==="create"?"Deuda Creada":"Deuda Actualizada",`La deuda ha sido ${t==="create"?"creada":"actualizada"}`),l.onSave?l.onSave():c(b.libreta())}catch(y){console.error("Error saving debt:",y),v("Error al guardar la deuda")}finally{O(!1)}};return e.jsxs("form",{onSubmit:fe,className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2 pb-4 scroll-container",children:[M&&e.jsxs("div",{className:Ie,children:[e.jsx(qe,{className:"w-5 h-5 flex-shrink-0"}),M]}),e.jsxs("div",{children:[e.jsxs("label",{className:D,children:["Tipo de Deuda ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>m("receivable"),className:`${J} ${i==="receivable"?_e:K}`,children:"Por Cobrar"}),e.jsx("button",{type:"button",onClick:()=>m("payable"),className:`${J} ${i==="payable"?Re:K}`,children:"Por Pagar"})]})]}),e.jsxs("div",{ref:q,className:"relative",children:[e.jsxs("label",{className:D,children:[i==="receivable"?"Cliente":"Proveedor"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a,onChange:s=>he(s.target.value),placeholder:i==="receivable"?"Nombre del cliente":"Nombre del proveedor",className:T,autoComplete:"off",required:!0}),oe&&W.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:W.map(s=>e.jsxs("button",{type:"button",onClick:()=>be(s),className:"w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors border-b border-slate-100 dark:border-slate-600 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-slate-800 dark:text-white",children:s.name}),s.phone&&e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:s.phone})]},s.id))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:D,children:["Monto ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:E,onChange:s=>p(s.target.value),placeholder:"0.00",className:T,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:D,children:["Descripción ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:x,onChange:s=>A(s.target.value),placeholder:"Concepto de la deuda",className:T,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:D,children:["Fecha de Vencimiento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:j,onChange:s=>_(s.target.value),className:T,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:D,children:"Notas"}),e.jsx("textarea",{value:S,onChange:s=>L(s.target.value),placeholder:"Información adicional...",rows:3,className:T})]})]}),e.jsx("div",{className:Le,children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full",children:[e.jsx("button",{type:"submit",disabled:I,className:re,children:I?"Guardando...":t==="create"?"Crear Deuda":"Actualizar"}),t==="edit"?e.jsxs("button",{type:"button",onClick:xe,disabled:I,className:Oe,children:[e.jsx(Ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Eliminar"})]}):e.jsx("button",{type:"button",onClick:me,disabled:I,className:ne,children:"Cancelar"})]})}),e.jsx(Xe,{isOpen:r,onClose:()=>u(!1),onConfirm:ue,title:"Eliminar Deuda",message:"¿Estás seguro de que deseas eliminar esta deuda? Esta acción no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar",variant:"danger"})]})},tt=l=>{const c=U(),k=f(r=>r.getById),o=f(r=>r.markAsPaid),C=f(r=>r.makePartialPayment),P=ae(r=>r.currencyCode),N=se(r=>r.showSuccessModal),t=l.debt??(l.debtId?k(l.debtId):null),d=l.currencyCode??P,[i,m]=n.useState(!1),[a,w]=n.useState(""),[E,p]=n.useState(null);if(!t){const r=()=>{l.onClose?l.onClose():c(b.libreta())};return e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-slate-600 dark:text-slate-400",children:"Deuda no encontrada"}),e.jsx("button",{onClick:r,className:le+" mt-4",children:"Volver a Libreta"})]})})}const x=t.status==="paid",A=t.status==="overdue",j=t.type==="receivable",_=()=>{l.onClose?l.onClose():c(b.libreta())},R=()=>{l.onEdit?l.onEdit():c(b.libretaEdit(t.id))},F=()=>{w(""),p(null),m(!0)},S=()=>{m(!1),l.onMarkAsPaid?l.onMarkAsPaid():o(t.id)&&(N("¡Deuda Pagada!",`La deuda con ${t.counterparty} ha sido marcada como pagada`),c(b.libreta()))},L=()=>{const r=parseFloat(a);if(isNaN(r)||r<=0){p("Ingresa un monto válido");return}if(r>t.amount){p("El monto no puede ser mayor al saldo");return}if(m(!1),l.onPartialPayment)l.onPartialPayment(r);else{const u=C(t.id,r);u&&(N("¡Abono Registrado!",`Abono de ${h(r,d)} registrado`),u.debt.status==="paid"&&c(b.libreta()))}},O=x?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300":A?"bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300":"bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300",M={paid:"Pagado",overdue:"Vencido",pending:"Pendiente"}[t.status]||t.status,v=j?"Por Cobrar":"Por Pagar";return e.jsxs("div",{className:Ee,children:[e.jsx("div",{className:De,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:_,className:Te,"aria-label":"Volver",children:e.jsx(Fe,{className:"w-5 h-5"})}),e.jsx("h2",{className:Pe,children:"Deuda"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50 dark:bg-slate-900 scroll-container",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 pb-8 pt-8 px-6 text-center shadow-sm",children:[e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-bold mb-3 ${O}`,children:[j?e.jsx(de,{className:"w-4 h-4 opacity-80"}):e.jsx(ie,{className:"w-4 h-4 opacity-80"}),e.jsxs("span",{children:[v," • ",M]})]}),e.jsx("h1",{className:"text-4xl font-extrabold tracking-tight text-slate-900 dark:text-white",children:h(t.amount,d)}),e.jsxs("p",{className:"text-slate-500 dark:text-slate-400 mt-2 text-sm font-medium",children:[j?"Cliente":"Proveedor",": ",e.jsx("span",{className:"text-slate-800 dark:text-slate-200",children:t.counterparty})]})]}),e.jsxs("div",{className:"mt-4 bg-white dark:bg-slate-800 border-y border-slate-200 dark:border-slate-700 px-4",children:[e.jsx(te,{label:"Descripción",value:t.description}),e.jsxs("div",{className:"flex justify-between items-center py-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 mb-1",children:"Vencimiento"}),e.jsx("span",{className:`text-sm font-bold ${A&&!x?"text-red-600":"text-slate-800 dark:text-white"}`,children:V(t.dueDate)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"block text-xs text-slate-500 mb-1",children:"Creado"}),e.jsx("span",{className:"text-sm font-medium text-slate-800 dark:text-white",children:V(t.createdAt)})]})]}),t.category&&e.jsx(te,{label:"Categoría",value:t.category}),t.notes&&e.jsxs("div",{className:"py-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("span",{className:"block text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-1",children:"Notas"}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 italic",children:['"',t.notes,'"']})]}),x&&t.paidAt&&e.jsxs("div",{className:"py-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("span",{className:"block text-xs font-bold uppercase tracking-wider text-emerald-600 dark:text-emerald-400 mb-1",children:"Estado"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-emerald-500"}),e.jsxs("span",{className:"text-sm text-slate-800 dark:text-slate-200",children:["Pagado el ",V(t.paidAt)]})]})]})]}),t.payments&&t.payments.length>0&&e.jsxs("div",{className:"mt-4 bg-white dark:bg-slate-800 border-y border-slate-200 dark:border-slate-700 px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400",children:["Historial de Abonos (",t.payments.length,")"]}),t.originalAmount&&e.jsxs("span",{className:"text-xs text-slate-400",children:["Original: ",h(t.originalAmount,d)]})]}),e.jsx("div",{className:"space-y-0 divide-y divide-slate-100 dark:divide-slate-700",children:t.payments.map((r,u)=>e.jsxs("div",{className:"flex justify-between items-center py-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-slate-800 dark:text-slate-200",children:["Abono #",u+1]}),e.jsx("p",{className:"text-xs text-slate-400",children:V(r.date)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold text-emerald-600 dark:text-emerald-400",children:["+",h(r.amount,d)]}),e.jsxs("p",{className:"text-xs text-slate-400 font-mono",children:["Ref: ",r.transactionId.slice(0,8)]})]})]},r.id))}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-200 dark:border-slate-600 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-600 dark:text-slate-300",children:"Total Abonado"}),e.jsx("span",{className:"text-sm font-bold text-emerald-600 dark:text-emerald-400",children:h(t.payments.reduce((r,u)=>r+u.amount,0),d)})]})]}),e.jsx("div",{className:"h-6 bg-slate-50 dark:bg-slate-900"})]}),e.jsx("div",{className:Ae,children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:F,disabled:x,className:x?Se:re,children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{children:x?"Pagado":"Abonar"})]}),e.jsxs("button",{onClick:R,className:ne,children:[e.jsx($e,{className:"w-5 h-5"}),e.jsx("span",{children:"Editar"})]})]})}),i&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>m(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:j?"Registrar Cobro":"Registrar Pago"}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:e.jsx(Ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"text-center py-3 bg-slate-50 dark:bg-slate-700/50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Saldo Pendiente"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:h(t.amount,d)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Monto a abonar"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:t.amount,value:a,onChange:r=>{w(r.target.value),p(null)},placeholder:"0.00",className:T,autoFocus:!0}),E&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:E})]})]}),e.jsxs("div",{className:"p-5 pt-0 space-y-3",children:[e.jsx("button",{onClick:L,disabled:!a,className:a?"w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-xl transition-colors":"w-full py-3 bg-slate-200 dark:bg-slate-700 text-slate-400 dark:text-slate-500 font-semibold rounded-xl cursor-not-allowed",children:"Abonar Monto"}),e.jsxs("button",{onClick:S,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl transition-colors",children:["Pagar Todo (",h(t.amount,d),")"]}),e.jsx("button",{onClick:()=>m(!1),className:"w-full py-2 text-slate-500 dark:text-slate-400 font-medium hover:text-slate-700 dark:hover:text-slate-200 transition-colors",children:"Cancelar"})]})]})]})]})};export{tt as D,Ze as L,et as a};
