import{b as R,g as b,c as F,r as i,j as e,p as v,d as T}from"./index-D08kE7DX.js";import{C as X,T as K,B as Q,a as q,S as J,L as Z,I as ee,b as se,E as te,F as k,c as C,d as ae,e as M,f as le,g as V,D as re,h as ne,i as ce,j as de,k as ie,l as oe}from"./styles-CB0P9xDY.js";import{f as P,a as B}from"./formatters-D9zA15X6.js";import{R as $,P as xe,I as L,E as me,T as ue,e as he,f as je}from"./index-Cn89rPqp.js";import{C as Ne}from"./ConfirmationModal-D8-a72df.js";import{B as z}from"./BarcodeScanner-Cyi9NThr.js";const Ee=s=>{const d=R(),u=b(a=>a.products),f=b(a=>a.lowStockCount),N=b(a=>a.loadProducts),o=F(a=>a.currencyCode),m=s.currencyCode??o;i.useEffect(()=>{N()},[N]);const t=()=>{s.onChangeView?s.onChangeView("create"):d(v.inventoryNew())},n=a=>{s.onChangeView?s.onChangeView("detail",a.id):d(v.inventoryDetail(a.id))};return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:X,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex w-full sm:w-auto justify-between items-center sm:gap-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:K,children:"Inventario"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Gestiona tus productos"})]}),e.jsx(z,{onScan:a=>{const c=u.find(x=>x.barcode===a.barcode);c?n(c):alert(`Producto con código ${a.barcode} no encontrado`)},title:"Buscar Producto",subtitle:"Escanea el código de barras para ver el producto",variant:"ghost",iconOnly:!0,size:"lg"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>d(v.inventoryPurchase()),className:Q,children:[e.jsx($,{className:"w-4 h-4"}),"Registrar Compra"]}),e.jsxs("button",{onClick:t,className:q,children:[e.jsx(xe,{className:"w-5 h-5"}),"Nuevo Producto"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-center mb-6",children:[e.jsxs("div",{className:J,children:[e.jsx("p",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-400",children:"Total Productos"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-300",children:u.length})]}),e.jsxs("div",{className:"bg-orange-100 dark:bg-orange-900/50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-sm font-medium text-orange-700 dark:text-orange-400",children:"Stock Bajo"}),e.jsx("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:f})]})]}),e.jsx("hr",{className:"border-slate-200 dark:border-slate-700 my-6"}),u.length===0?e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400 dark:text-slate-500 mb-4",children:e.jsx(L,{className:"w-16 h-16 mx-auto"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-600 dark:text-slate-400 mb-2",children:"No hay productos en el inventario"}),e.jsx("button",{onClick:t,className:"mt-4 text-emerald-600 dark:text-emerald-400 hover:underline font-semibold",children:"Crear tu primer producto"})]}):e.jsx("ul",{className:"divide-y divide-slate-200 dark:divide-slate-700 -mx-2",children:u.map(a=>{let c="bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300",x="En Stock";return a.quantity===0?(c="bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400",x="Sin Stock"):a.quantity<=10&&(c="bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300",x="Stock Bajo"),e.jsx("li",{onClick:()=>n(a),className:Z,children:e.jsxs("div",{className:"flex items-center justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-3 min-w-0",children:[e.jsx("div",{className:`p-3 rounded-xl shrink-0 ${ee}`,children:e.jsx(L,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100 truncate",children:a.name}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 truncate mb-1",children:a.description||"Sin descripción"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[e.jsx("span",{className:`px-2.5 py-0.5 text-xs font-semibold rounded-md ${c}`,children:x}),a.category&&e.jsx("span",{className:"hidden sm:inline-block px-2.5 py-0.5 text-xs font-medium bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-md border border-slate-200 dark:border-slate-600",children:a.category}),e.jsx("div",{className:"flex items-center text-xs text-slate-400 dark:text-slate-500 font-medium",children:e.jsxs("span",{className:"whitespace-nowrap",children:[a.quantity," unid"]})})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end shrink-0 ml-2",children:[e.jsx("div",{className:`text-xl sm:text-2xl font-bold whitespace-nowrap flex items-baseline gap-1 ${se}`,children:e.jsx("span",{children:P(a.price,m)})}),e.jsx("span",{className:"text-xs text-slate-400 font-medium",children:"Precio unitario"})]})]})},a.id)})})]})})},ye=s=>{const d=R(),u=b(l=>l.products),f=b(l=>l.createProduct),N=b(l=>l.updateProduct),o=b(l=>l.deleteProduct),m=T(l=>l.showSuccessModal),t=s.product??(s.productId?u.find(l=>l.id===s.productId):null)??null,[n,a]=i.useState(""),[c,x]=i.useState(""),[h,r]=i.useState(""),[j,g]=i.useState(""),[E,S]=i.useState(""),[p,_]=i.useState(""),[A,I]=i.useState(""),[O,y]=i.useState(null),[U,D]=i.useState(!1);i.useEffect(()=>{t?(a(t.name||""),x(t.description||""),r(t.price!==void 0&&t.price!==null?t.price.toString():""),g(t.cost!==void 0&&t.cost!==null?t.cost.toString():"0"),S(t.category||""),_(t.quantity!==void 0&&t.quantity!==null?t.quantity.toString():""),I(t.barcode||"")):(a(""),x(""),r(""),g(""),S(""),_(""),I(""))},[t]);const H=()=>{s.onCancel?s.onCancel():d(v.inventory())},G=()=>{D(!0)},Y=()=>{t&&o(t.id)&&(m("Producto Eliminado",`${t.name} ha sido eliminado`),D(!1),s.onDelete?s.onDelete():d(v.inventory()))},W=async l=>{if(l.preventDefault(),y(null),!n.trim()||!h||parseFloat(h)<0){y("Por favor completa todos los campos requeridos.");return}if(j===""||parseFloat(j)<0){y("Por favor ingresa un costo válido.");return}if(!p||parseInt(p)<0){y("Por favor ingresa una cantidad válida.");return}try{let w;if(t?w=N(t.id,{name:n,description:c||void 0,price:parseFloat(h),cost:parseFloat(j),category:E||void 0,quantity:parseInt(p),barcode:A||void 0}):w=f(n,parseFloat(h),parseFloat(j),parseInt(p),c||void 0,E||void 0,A||void 0),!w){y("Error al guardar el producto.");return}m(t?"Producto Actualizado":"Producto Creado",`${n} ha sido ${t?"actualizado":"creado"}`),s.onSave?s.onSave():d(v.inventory())}catch(w){console.error("Error saving product:",w),y("Error al guardar el producto.")}};return e.jsxs("form",{onSubmit:W,className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2 pb-4 scroll-container",children:[O&&e.jsxs("div",{className:te,children:[e.jsx(me,{className:"w-5 h-5 flex-shrink-0"}),O]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:["Nombre del Producto ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:n,onChange:l=>a(l.target.value),placeholder:"Ej: Camiseta básica",required:!0,className:C})]}),e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Descripción"}),e.jsx("textarea",{value:c,onChange:l=>x(l.target.value),placeholder:"Descripción del producto...",rows:3,className:`${C} resize-none`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:k,children:["Precio Venta ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:h,onChange:l=>r(l.target.value),placeholder:"0.00",min:"0",step:"0.01",required:!0,className:C})]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:["Costo Unitario ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:j,onChange:l=>g(l.target.value),placeholder:"0.00",min:"0",step:"0.01",required:!0,className:C})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Categoría"}),e.jsx("input",{type:"text",value:E,onChange:l=>S(l.target.value),placeholder:"Ej: Ropa, Electrónica",className:C})]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:["Cantidad Disponible ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:p,onChange:l=>_(l.target.value),placeholder:"0",min:"0",required:!0,className:C})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Código de Barras"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:A,onChange:l=>I(l.target.value),placeholder:"Ej: 7501234567890",className:`${C} flex-1`}),e.jsx(z,{onScan:l=>I(l.barcode),title:"Escanear Código",subtitle:"Escanea el código de barras del producto",variant:"secondary",iconOnly:!0,size:"md"})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Escanea o ingresa el código de barras/SKU del producto"})]})]}),e.jsx("div",{className:ae,children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full",children:[e.jsx("button",{type:"submit",className:M,children:t?"Actualizar":"Crear Producto"}),t?e.jsxs("button",{type:"button",onClick:G,className:le,children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Eliminar"})]}):e.jsx("button",{type:"button",onClick:H,className:V,children:"Cancelar"})]})}),e.jsx(Ne,{isOpen:U,onClose:()=>D(!1),onConfirm:Y,title:"Eliminar Producto",message:"¿Estás seguro de que deseas eliminar este producto? Esta acción no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar",variant:"danger"})]})},ge=({product:s,currencyCode:d,onClose:u,onEdit:f,onUpdateStock:N})=>{const[o,m]=i.useState(null),t=o!==null?o:s.quantity,n=o!==null&&o!==s.quantity,a=s.cost||0,c=s.price-a,h=c<0?"text-red-600 dark:text-red-400":"text-emerald-600 dark:text-emerald-400",r=s.price>0?(c/s.price*100).toFixed(1):"0.0",j=S=>{const p=Math.max(0,t+S);m(p)},g=()=>{!N||!n||o===null||(N(s.id,o),m(null))},E=t<=10;return e.jsxs("div",{className:re,children:[e.jsx("div",{className:ne,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:u,className:ce,"aria-label":"Volver",children:e.jsx(he,{className:"w-5 h-5"})}),e.jsx("h2",{className:de,children:"Producto"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50 dark:bg-slate-900 scroll-container",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 shadow-sm mb-4",children:e.jsxs("div",{className:"px-6 py-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white leading-tight mb-2",children:s.name}),e.jsx("div",{className:"flex items-center justify-center gap-3 mb-2",children:e.jsx("span",{className:"text-3xl font-extrabold text-slate-800 dark:text-white",children:P(s.price,d)})}),e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${E?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"}`,children:E?"⚠️ Stock Bajo":"Stock Disponible"}),e.jsxs("div",{className:"mt-6 grid grid-cols-3 gap-2 bg-slate-50 dark:bg-slate-700/50 p-3 rounded-xl border border-slate-100 dark:border-slate-600",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Costo"}),e.jsx("p",{className:"font-semibold text-slate-700 dark:text-slate-300",children:P(a,d)})]}),e.jsxs("div",{className:"text-center border-l border-slate-200 dark:border-slate-600",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Ganancia"}),e.jsx("p",{className:`font-bold ${h}`,children:P(c,d)})]}),e.jsxs("div",{className:"text-center border-l border-slate-200 dark:border-slate-600",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Margen"}),e.jsxs("p",{className:`font-semibold ${h}`,children:[r,"%"]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>j(-1),disabled:t===0,className:"w-9 h-9 flex items-center justify-center bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 rounded-lg disabled:opacity-50 transition-colors text-lg font-bold text-slate-700 dark:text-white",children:"−"}),e.jsx("span",{className:"w-14 text-center font-bold text-lg text-slate-800 dark:text-white",children:t}),e.jsx("button",{type:"button",onClick:()=>j(1),className:"w-9 h-9 flex items-center justify-center bg-emerald-500 dark:bg-emerald-600 hover:bg-emerald-600 dark:hover:bg-emerald-700 text-white rounded-lg transition-colors text-lg font-bold",children:"+"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-y border-slate-200 dark:border-slate-700 px-4",children:[s.description&&e.jsxs("div",{className:"py-4 border-b border-slate-100 dark:border-slate-700 last:border-0",children:[e.jsx("span",{className:"block text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-1",children:"Descripción"}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 leading-relaxed",children:s.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 mb-1",children:"Creado"}),e.jsx("span",{className:"text-sm font-medium text-slate-800 dark:text-white",children:B(s.createdAt)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 mb-1",children:"Actualizado"}),e.jsx("span",{className:"text-sm font-medium text-slate-800 dark:text-white",children:B(s.updatedAt)})]})]})]}),e.jsx("div",{className:"h-6"})]}),e.jsx("div",{className:ie,children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:g,disabled:!n,className:n?M:oe,children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{children:"Actualizar"})]}),e.jsxs("button",{onClick:f,className:V,children:[e.jsx(je,{className:"w-5 h-5"}),e.jsx("span",{children:"Editar"})]})]})})]})},Se=s=>{const d=R(),u=b(r=>r.products),f=b(r=>r.updateProduct),N=F(r=>r.currencyCode),o=T(r=>r.showSuccessModal),m=T(r=>r.setHideAppShell),t=T(r=>r.setHideBottomNav);i.useEffect(()=>(m(!0),t(!0),()=>{m(!1),t(!1)}),[m,t]);const n=s.product??(s.productId?u.find(r=>r.id===s.productId):void 0),a=s.currencyCode??N,c=()=>{s.onClose?s.onClose():d(v.inventory())},x=i.useCallback(()=>{n&&(s.onEdit?s.onEdit(n.id):d(v.inventoryEdit(n.id)))},[n,s.onEdit,d]),h=i.useCallback((r,j)=>{const g=f(r,{quantity:j});g&&(s.onSuccess?s.onSuccess("¡Stock Actualizado!",`El inventario de ${g.name} ha sido actualizado`):o("¡Stock Actualizado!",`El inventario de ${g.name} ha sido actualizado`))},[f,s.onSuccess,o]);return n?e.jsx("div",{className:"w-full h-full animate-fade-in",children:e.jsx(ge,{product:n,currencyCode:a,onClose:c,onEdit:x,onUpdateStock:h})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-slate-600 dark:text-slate-400",children:"Producto no encontrado"}),e.jsx("button",{onClick:c,className:q+" mt-4",children:"Volver al Inventario"})]})})};export{Ee as I,Se as P,ye as a};
