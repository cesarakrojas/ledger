import{I as q,T as G,g as A,z as r,c as Q,d as v,r as k,j as e}from"./index-BtpNWAWx.js";import{S as F,e as H,D as _,T as z,X as U,U as X,c as W}from"./index-CFVEre9y.js";import{B as Y}from"./BarcodeScanner-C3exYXmT.js";import{C as K,T as J,c as Z,h as ee,i as te,j as se,f as ae,g as re,b as le}from"./styles-CB0P9xDY.js";import{f as x}from"./formatters-BcPrGXqa.js";const de="app:transactions-changed",ne=()=>{window.dispatchEvent(new CustomEvent(de))},ce={completeSale:(s,d)=>{const c=s.reduce((a,i)=>a+i.unitPrice*i.quantity,0),p=s.reduce((a,i)=>a+i.cost*i.quantity,0),m=`Venta POS: ${s.map(a=>`${a.quantity}x ${a.product.name}`).join(", ")}`,l=s.map(a=>({productId:a.product.id,quantityDelta:-a.quantity})),u=q.batchAdjustStock(l).filter(a=>!a.success);if(u.length>0)return console.error("Inventory adjustments failed; aborting sale. Failed adjustments:",u),null;const h=G.add("inflow",m,c,"POS",d,p);return h&&ne(),h},calculateGrossProfit:(s,d)=>s-d,calculateGrossMargin:(s,d)=>s===0?0:(s-d)/s*100},oe=[{id:"all",name:"Todos"},{id:"grains",name:"Granos y Frutos"},{id:"drinks",name:"Bebidas"},{id:"dairy",name:"Lácteos"},{id:"sweets",name:"Dulces"},{id:"wellness",name:"Bienestar"}],ie=s=>{switch(s){case"grains":return"bg-amber-500";case"drinks":return"bg-emerald-500";case"sweets":return"bg-orange-500";case"dairy":return"bg-yellow-500";case"wellness":return"bg-teal-500";default:return"bg-slate-500"}},xe=({product:s,onAdd:d})=>e.jsx("div",{onClick:()=>d(s),className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col active:scale-95 transition-transform duration-100 touch-manipulation h-full shadow-sm dark:shadow-none",children:e.jsxs("div",{className:"p-3 flex items-start gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-md flex-shrink-0 ${ie(s.category)}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm leading-tight mb-1 line-clamp-2",children:s.name}),e.jsx("div",{className:"mt-2 flex items-center justify-between",children:e.jsx("span",{className:`text-xl sm:text-2xl font-bold ${le}`,children:x(s.price)})})]})]})}),me=({value:s,onChange:d,onAction:c})=>{const p=["1","2","3","Qty","4","5","6","%","7","8","9","Price","+/-","0",".","⌫"],f=l=>{if(["Qty","%","Price"].includes(l)){c(l);return}if(l==="⌫"){d(s.length>1?s.slice(0,-1):"0");return}if(l==="+/-"){d(s.startsWith("-")?s.slice(1):"-"+s);return}if(s==="0"&&l!==".")d(l);else{if(l==="."&&s.includes("."))return;d(s+l)}},m=l=>{const o="h-12 rounded-lg font-semibold text-lg flex items-center justify-center active:scale-95 transition-all duration-150";return["Qty","%","Price"].includes(l)?`${o} bg-emerald-50 hover:bg-emerald-100 dark:bg-emerald-900/30 dark:hover:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300 border border-emerald-200 dark:border-emerald-700`:l==="⌫"?`${o} bg-red-50 hover:bg-red-100 dark:bg-red-900/30 dark:hover:bg-red-900/50 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-700`:`${o} bg-white hover:bg-slate-50 dark:bg-slate-700 dark:hover:bg-slate-600 border border-slate-200 dark:border-slate-600 text-slate-700 dark:text-slate-100 shadow-sm dark:shadow-none`};return e.jsx("div",{className:"grid grid-cols-4 gap-2 p-3 bg-slate-100 dark:bg-slate-900/50 rounded-xl border border-slate-200 dark:border-slate-700",children:p.map(l=>e.jsx("button",{onClick:()=>f(l),className:m(l),children:l},l))})},ue=({item:s,isEditing:d,onClick:c})=>e.jsxs("div",{onClick:c,className:`relative p-3 rounded-xl border flex justify-between items-start transition-colors cursor-pointer ${d?"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-700 ring-1 ring-emerald-200 dark:ring-emerald-700":"bg-white dark:bg-slate-800 border-slate-100 dark:border-slate-700 shadow-sm dark:shadow-none"}`,children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-slate-900 dark:text-slate-100",children:s.name}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-300 mt-1 flex gap-2",children:e.jsxs("span",{children:[s.quantity," x ",x(s.price)," / ",s.unit]})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100",children:x(s.price*s.quantity)}),d&&e.jsx("div",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium mt-1",children:"Editando"})]})]}),he=()=>{const s=A(t=>t.products),d=A(t=>t.loadProducts),c=r(t=>t.cart),p=r(t=>t.subtotal),f=r(t=>t.tax),m=r(t=>t.total),l=r(t=>t.itemCount),o=r(t=>t.activeTab),u=r(t=>t.selectedCategory),h=r(t=>t.searchQuery),a=r(t=>t.editingItem),i=r(t=>t.numpadValue),y=r(t=>t.paymentMethod),w=r(t=>t.addToCart),g=r(t=>t.updateCartItem),O=r(t=>t.removeFromCart),$=r(t=>t.clearCart),C=r(t=>t.setActiveTab),M=r(t=>t.setSelectedCategory),S=r(t=>t.setSearchQuery),T=r(t=>t.setEditingItem),E=r(t=>t.setNumpadValue),B=r(t=>t.setPaymentMethod),R=Q(t=>t.paymentMethods),I=v(t=>t.showSuccessModal),j=v(t=>t.setHideBottomNav),N=v(t=>t.setHideAppShell);k.useEffect(()=>{d()},[d]),k.useEffect(()=>(j(o==="cart"),N(o==="cart"),()=>{j(!1),N(!1)}),[o,j,N]);const P=k.useMemo(()=>s.filter(t=>{const n=u==="all"||t.category===u,b=t.name.toLowerCase().includes(h.toLowerCase());return n&&b}),[s,u,h]),D=t=>{if(!a)return;const n=parseFloat(i);if(!(Number.isNaN(n)||n<0)){if(t==="Qty")g(a.id,{quantity:n});else if(t==="Price")g(a.id,{price:n});else if(t==="%"){const b=a.price,V=b-b*(n/100);g(a.id,{price:Math.max(0,V)})}E("0")}},L=()=>{if(c.length===0)return;const t=c.map(n=>({product:{id:n.id,name:n.name,price:n.price},quantity:n.quantity,unitPrice:n.price,cost:n.cost}));ce.completeSale(t,y),$(),I("Venta Completada",`Total cobrado: ${x(m)}`)};return e.jsxs("div",{className:"w-full animate-fade-in text-slate-900 dark:text-slate-100",children:[o!=="cart"&&e.jsx("div",{className:`${K} rounded-b-none`,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:J,children:"Punto de Venta"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Gestiona tus ventas y cobros"})]})}),e.jsxs("div",{className:"relative overflow-hidden bg-slate-50 dark:bg-slate-900",children:[e.jsxs("div",{className:`flex flex-col transition-transform duration-300 ${o==="products"?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"px-4 py-3 z-10 bg-white dark:bg-slate-800",children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 dark:text-slate-200"}),e.jsx("input",{value:h,onChange:t=>S(t.target.value),placeholder:"Buscar productos...",className:`${Z} pl-9`})]}),e.jsx(Y,{onScan:t=>{const n=s.find(b=>b.barcode===t.barcode);n?(w(n),I("Producto Agregado",`${n.name} añadido al carrito`)):S(t.barcode)},title:"Escanear Producto",subtitle:"Escanea el código de barras para agregar al carrito",variant:"primary",iconOnly:!0,size:"md"})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-1 -mx-4 px-4",children:oe.map(t=>e.jsx("button",{onClick:()=>M(t.id),className:`whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium transition-colors ${u===t.id?"bg-emerald-600 text-white dark:bg-emerald-500":"bg-white border border-slate-200 text-slate-600 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-300"}`,children:t.name},t.id))})]}),e.jsx("div",{className:"p-4 pb-24",children:P.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-500 dark:text-slate-400",children:[e.jsx("p",{children:"No hay productos disponibles"}),e.jsx("p",{className:"text-sm mt-2",children:"Agrega productos en el módulo de Inventario"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-3 pb-8",children:P.map(t=>e.jsx(xe,{product:t,onAdd:w},t.id))})})]}),e.jsxs("div",{className:`fixed inset-0 z-[60] bg-white dark:bg-slate-800 flex flex-col transition-transform duration-300 ${o==="cart"?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:ee,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>C("products"),className:te,"aria-label":"Volver",children:e.jsx(H,{className:"w-5 h-5"})}),e.jsx("h2",{className:se,children:"Orden Actual"})]}),e.jsx("div",{className:"text-sm font-medium text-emerald-600 bg-emerald-50 dark:bg-emerald-900/20 px-3 py-1 rounded-full",children:"Invitado"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 dark:text-slate-400 opacity-60",children:[e.jsx(_,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Carrito vacío"})]}):e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsx(ue,{item:t,isEditing:(a==null?void 0:a.id)===t.id,onClick:()=>T(t)},t.id))})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] dark:shadow-none",children:a?e.jsxs("div",{className:"p-4 bg-white dark:bg-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"font-medium text-slate-500 dark:text-slate-300 text-sm",children:["Editando: ",e.jsx("span",{className:"text-slate-900 dark:text-slate-100",children:a.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>O(a.id),className:`${ae} px-3 py-2 text-sm`,children:[e.jsx(z,{className:"w-4 h-4"}),"Quitar"]}),e.jsxs("button",{onClick:()=>T(null),className:`${re} px-3 py-2 text-sm`,children:[e.jsx(U,{className:"w-4 h-4"}),"Cerrar"]})]})]}),e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 bg-slate-50 dark:bg-slate-700 rounded-lg flex flex-col justify-center px-4 py-2",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-300 uppercase font-semibold tracking-wider",children:"Entrada"}),e.jsx("span",{className:"text-2xl font-mono text-slate-900 dark:text-slate-100",children:i})]}),e.jsxs("div",{className:"flex-none w-24 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg flex flex-col justify-center items-center",children:[e.jsx("span",{className:"text-xs text-slate-400 dark:text-slate-300",children:"Cantidad actual"}),e.jsx("span",{className:"text-xl font-bold text-emerald-600 dark:text-emerald-400",children:a.quantity})]})]}),e.jsx(me,{value:i,onChange:E,onAction:D})]}):e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{className:"flex flex-col items-center justify-center py-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx(X,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400 mb-1"}),e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:"Cliente"})]}),e.jsxs("button",{className:"flex flex-col items-center justify-center py-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx(_,{className:"w-5 h-5 text-slate-500 dark:text-slate-300 mb-1"}),e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:"Nota"})]}),e.jsxs("button",{className:"flex flex-col items-center justify-center py-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"w-5 h-5 text-slate-500 dark:text-slate-300 mb-1"}),e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:"Acciones"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Método de Pago"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(t=>e.jsx("button",{onClick:()=>B(t),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${y===t?"bg-emerald-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-600"}`,children:t},t))})]}),e.jsxs("div",{className:"space-y-1 pt-2 border-t border-dashed border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between text-slate-500 dark:text-slate-300 text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:x(p)})]}),e.jsxs("div",{className:"flex justify-between text-slate-500 dark:text-slate-300 text-sm",children:[e.jsx("span",{children:"Impuestos (10%)"}),e.jsx("span",{children:x(f)})]}),e.jsxs("div",{className:"flex justify-between text-slate-900 dark:text-slate-100 font-bold text-xl pt-1",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:x(m)})]})]}),e.jsxs("button",{onClick:L,disabled:c.length===0,className:"w-full bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300 dark:disabled:bg-slate-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-emerald-500/20 active:scale-[0.98] transition-all flex items-center justify-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Pagar ",x(m)]})]})})]}),e.jsx("div",{style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 5rem)"},className:`fixed left-4 right-4 z-[55] transition-all duration-300 transform ${o!=="cart"&&c.length>0?"translate-y-0 opacity-100":"translate-y-20 opacity-0 pointer-events-none"}`,children:e.jsxs("button",{onClick:()=>C("cart"),className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white p-4 rounded-2xl shadow-xl shadow-emerald-500/30 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-white/20 dark:bg-white/10 px-3 py-1 rounded-full text-sm font-bold",children:[l," artículos"]}),e.jsx("span",{className:"text-sm text-emerald-100",children:"Ver carrito"})]}),e.jsx("div",{className:"font-bold text-lg",children:x(m)})]})})]})]})},Ne=()=>e.jsx(he,{});export{Ne as default};
