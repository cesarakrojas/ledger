import{I as L,T as V,g as C,t as l,d as S,r as N,j as e}from"./index-Bh3Pq5fI.js";import{S as q,e as B,D as T,T as G,X as Q,U as F,c as M}from"./index-DI_LCI5M.js";import{C as H,T as U,b as X,g as z,h as W,i as Y,e as K,f as J,a as Z}from"./styles-QfzEYZlC.js";import{f as x}from"./formatters-BwYXHfTr.js";const ee="app:transactions-changed",te=()=>{window.dispatchEvent(new CustomEvent(ee))},se={completeSale:(s,d)=>{const c=s.reduce((a,i)=>a+i.unitPrice*i.quantity,0),b=s.reduce((a,i)=>a+i.cost*i.quantity,0),m=`Venta POS: ${s.map(a=>`${a.quantity}x ${a.product.name}`).join(", ")}`,r=s.map(a=>({productId:a.product.id,quantityDelta:-a.quantity})),u=L.batchAdjustStock(r).filter(a=>!a.success);if(u.length>0)return console.error("Inventory adjustments failed; aborting sale. Failed adjustments:",u),null;const h=V.add("inflow",m,c,"POS",d,b);return h&&te(),h},calculateGrossProfit:(s,d)=>s-d,calculateGrossMargin:(s,d)=>s===0?0:(s-d)/s*100},ae=[{id:"all",name:"Todos"},{id:"grains",name:"Granos y Frutos"},{id:"drinks",name:"Bebidas"},{id:"dairy",name:"Lácteos"},{id:"sweets",name:"Dulces"},{id:"wellness",name:"Bienestar"}],re=s=>{switch(s){case"grains":return"bg-amber-500";case"drinks":return"bg-emerald-500";case"sweets":return"bg-orange-500";case"dairy":return"bg-yellow-500";case"wellness":return"bg-teal-500";default:return"bg-slate-500"}},le=({product:s,onAdd:d})=>e.jsx("div",{onClick:()=>d(s),className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col active:scale-95 transition-transform duration-100 touch-manipulation h-full shadow-sm dark:shadow-none",children:e.jsxs("div",{className:"p-3 flex items-start gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-md flex-shrink-0 ${re(s.category)}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm leading-tight mb-1 line-clamp-2",children:s.name}),e.jsx("div",{className:"mt-2 flex items-center justify-between",children:e.jsx("span",{className:`text-xl sm:text-2xl font-bold ${Z}`,children:x(s.price)})})]})]})}),de=({value:s,onChange:d,onAction:c})=>{const b=["1","2","3","Qty","4","5","6","%","7","8","9","Price","+/-","0",".","⌫"],f=r=>{if(["Qty","%","Price"].includes(r)){c(r);return}if(r==="⌫"){d(s.length>1?s.slice(0,-1):"0");return}if(r==="+/-"){d(s.startsWith("-")?s.slice(1):"-"+s);return}if(s==="0"&&r!==".")d(r);else{if(r==="."&&s.includes("."))return;d(s+r)}},m=r=>{const o="h-12 rounded-lg font-semibold text-lg flex items-center justify-center active:scale-95 transition-all duration-150";return["Qty","%","Price"].includes(r)?`${o} bg-emerald-50 hover:bg-emerald-100 dark:bg-emerald-900/30 dark:hover:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300 border border-emerald-200 dark:border-emerald-700`:r==="⌫"?`${o} bg-red-50 hover:bg-red-100 dark:bg-red-900/30 dark:hover:bg-red-900/50 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-700`:`${o} bg-white hover:bg-slate-50 dark:bg-slate-700 dark:hover:bg-slate-600 border border-slate-200 dark:border-slate-600 text-slate-700 dark:text-slate-100 shadow-sm dark:shadow-none`};return e.jsx("div",{className:"grid grid-cols-4 gap-2 p-3 bg-slate-100 dark:bg-slate-900/50 rounded-xl border border-slate-200 dark:border-slate-700",children:b.map(r=>e.jsx("button",{onClick:()=>f(r),className:m(r),children:r},r))})},ne=({item:s,isEditing:d,onClick:c})=>e.jsxs("div",{onClick:c,className:`relative p-3 rounded-xl border flex justify-between items-start transition-colors cursor-pointer ${d?"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-700 ring-1 ring-emerald-200 dark:ring-emerald-700":"bg-white dark:bg-slate-800 border-slate-100 dark:border-slate-700 shadow-sm dark:shadow-none"}`,children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-slate-900 dark:text-slate-100",children:s.name}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-300 mt-1 flex gap-2",children:e.jsxs("span",{children:[s.quantity," x ",x(s.price)," / ",s.unit]})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100",children:x(s.price*s.quantity)}),d&&e.jsx("div",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-medium mt-1",children:"Editando"})]})]}),ce=()=>{const s=C(t=>t.products),d=C(t=>t.loadProducts),c=l(t=>t.cart),b=l(t=>t.subtotal),f=l(t=>t.tax),m=l(t=>t.total),r=l(t=>t.itemCount),o=l(t=>t.activeTab),u=l(t=>t.selectedCategory),h=l(t=>t.searchQuery),a=l(t=>t.editingItem),i=l(t=>t.numpadValue),E=l(t=>t.addToCart),g=l(t=>t.updateCartItem),I=l(t=>t.removeFromCart),P=l(t=>t.clearCart),v=l(t=>t.setActiveTab),A=l(t=>t.setSelectedCategory),_=l(t=>t.setSearchQuery),k=l(t=>t.setEditingItem),w=l(t=>t.setNumpadValue),O=S(t=>t.showSuccessModal),j=S(t=>t.setHideBottomNav);N.useEffect(()=>{d()},[d]),N.useEffect(()=>(j(o==="cart"),()=>j(!1)),[o,j]);const y=N.useMemo(()=>s.filter(t=>{const n=u==="all"||t.category===u,p=t.name.toLowerCase().includes(h.toLowerCase());return n&&p}),[s,u,h]),$=t=>{if(!a)return;const n=parseFloat(i);if(!(Number.isNaN(n)||n<0)){if(t==="Qty")g(a.id,{quantity:n});else if(t==="Price")g(a.id,{price:n});else if(t==="%"){const p=a.price,D=p-p*(n/100);g(a.id,{price:Math.max(0,D)})}w("0")}},R=()=>{if(c.length===0)return;const t=c.map(n=>({product:{id:n.id,name:n.name,price:n.price},quantity:n.quantity,unitPrice:n.price,cost:n.cost}));se.completeSale(t,"cash"),P(),O("Venta Completada",`Total cobrado: ${x(m)}`)};return e.jsxs("div",{className:"w-full animate-fade-in text-slate-900 dark:text-slate-100",children:[o!=="cart"&&e.jsx("div",{className:`${H} rounded-b-none`,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:U,children:"Punto de Venta"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Gestiona tus ventas y cobros"})]})}),e.jsxs("div",{className:"relative overflow-hidden bg-slate-50 dark:bg-slate-900",children:[e.jsxs("div",{className:`flex flex-col transition-transform duration-300 ${o==="products"?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"px-4 py-3 z-10 bg-white dark:bg-slate-800",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 dark:text-slate-200"}),e.jsx("input",{value:h,onChange:t=>_(t.target.value),placeholder:"Buscar productos...",className:`${X} pl-9`})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-1 -mx-4 px-4",children:ae.map(t=>e.jsx("button",{onClick:()=>A(t.id),className:`whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium transition-colors ${u===t.id?"bg-emerald-600 text-white dark:bg-emerald-500":"bg-white border border-slate-200 text-slate-600 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-300"}`,children:t.name},t.id))})]}),e.jsx("div",{className:"p-4 pb-24",children:y.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-500 dark:text-slate-400",children:[e.jsx("p",{children:"No hay productos disponibles"}),e.jsx("p",{className:"text-sm mt-2",children:"Agrega productos en el módulo de Inventario"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-3 pb-8",children:y.map(t=>e.jsx(le,{product:t,onAdd:E},t.id))})})]}),e.jsxs("div",{className:`fixed inset-0 z-70 h-[100dvh] bg-white dark:bg-slate-800 flex flex-col transition-transform duration-300 ${o==="cart"?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:z,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>v("products"),className:W,"aria-label":"Volver",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsx("h2",{className:Y,children:"Orden Actual"})]}),e.jsx("div",{className:"text-sm font-medium text-emerald-600 bg-emerald-50 dark:bg-emerald-900/20 px-3 py-1 rounded-full",children:"Invitado"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 dark:text-slate-400 opacity-60",children:[e.jsx(T,{className:"w-16 h-16 mb-4"}),e.jsx("p",{children:"Carrito vacío"})]}):e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsx(ne,{item:t,isEditing:(a==null?void 0:a.id)===t.id,onClick:()=>k(t)},t.id))})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] dark:shadow-none",children:a?e.jsxs("div",{className:"p-4 bg-white dark:bg-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"font-medium text-slate-500 dark:text-slate-300 text-sm",children:["Editando: ",e.jsx("span",{className:"text-slate-900 dark:text-slate-100",children:a.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I(a.id),className:`${K} px-3 py-2 text-sm`,children:[e.jsx(G,{className:"w-4 h-4"}),"Quitar"]}),e.jsxs("button",{onClick:()=>k(null),className:`${J} px-3 py-2 text-sm`,children:[e.jsx(Q,{className:"w-4 h-4"}),"Cerrar"]})]})]}),e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 bg-slate-50 dark:bg-slate-700 rounded-lg flex flex-col justify-center px-4 py-2",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-300 uppercase font-semibold tracking-wider",children:"Entrada"}),e.jsx("span",{className:"text-2xl font-mono text-slate-900 dark:text-slate-100",children:i})]}),e.jsxs("div",{className:"flex-none w-24 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg flex flex-col justify-center items-center",children:[e.jsx("span",{className:"text-xs text-slate-400 dark:text-slate-300",children:"Cantidad actual"}),e.jsx("span",{className:"text-xl font-bold text-emerald-600 dark:text-emerald-400",children:a.quantity})]})]}),e.jsx(de,{value:i,onChange:w,onAction:$})]}):e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{className:"flex flex-col items-center justify-center py-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx(F,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400 mb-1"}),e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:"Cliente"})]}),e.jsxs("button",{className:"flex flex-col items-center justify-center py-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx(T,{className:"w-5 h-5 text-slate-500 dark:text-slate-300 mb-1"}),e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:"Nota"})]}),e.jsxs("button",{className:"flex flex-col items-center justify-center py-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"w-5 h-5 text-slate-500 dark:text-slate-300 mb-1"}),e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:"Acciones"})]})]}),e.jsxs("div",{className:"space-y-1 pt-2 border-t border-dashed border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between text-slate-500 dark:text-slate-300 text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:x(b)})]}),e.jsxs("div",{className:"flex justify-between text-slate-500 dark:text-slate-300 text-sm",children:[e.jsx("span",{children:"Impuestos (10%)"}),e.jsx("span",{children:x(f)})]}),e.jsxs("div",{className:"flex justify-between text-slate-900 dark:text-slate-100 font-bold text-xl pt-1",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:x(m)})]})]}),e.jsxs("button",{onClick:R,disabled:c.length===0,className:"w-full bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300 dark:disabled:bg-slate-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-emerald-500/20 active:scale-[0.98] transition-all flex items-center justify-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Pagar ",x(m)]})]})})]}),e.jsx("div",{style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 5rem)"},className:`fixed left-4 right-4 z-60 transition-all duration-300 transform ${o!=="cart"&&c.length>0?"translate-y-0 opacity-100":"translate-y-20 opacity-0 pointer-events-none"}`,children:e.jsxs("button",{onClick:()=>v("cart"),className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white p-4 rounded-2xl shadow-xl shadow-emerald-500/30 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-white/20 dark:bg-white/10 px-3 py-1 rounded-full text-sm font-bold",children:[r," artículos"]}),e.jsx("span",{className:"text-sm text-emerald-100",children:"Ver carrito"})]}),e.jsx("div",{className:"font-bold text-lg",children:x(m)})]})})]})]})},ue=()=>e.jsx(ce,{});export{ue as default};
